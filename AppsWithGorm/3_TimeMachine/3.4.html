<!doctype html>
<html class="no-js" lang="en" data-content_root="">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="4 - Money" href="../4_Money/index.html" /><link rel="prev" title="3.3 - New Time Zone Dialog" href="3.3.html" />

    <!-- Generated with Sphinx 7.1.2 and Furo 2024.01.29 -->
        <title>3.4 - Multiple Clocks - GNUstep Tutorials 2024 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=135e06be" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">GNUstep Tutorials 2024 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">GNUstep Tutorials 2024 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../ObjectiveCIntro/index.html">Introduction to Objective-C</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../index.html">Building Apps with GORM</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Building Apps with GORM</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../1_Intro/index.html">1 - Introduction to GNUstep Programming</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../2_Convertor/index.html">2 - Convertor</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of 2 - Convertor</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../2_Convertor/2.1.html">2.1 - Designing the UI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../2_Convertor/2.2.html">2.2 - Outlets and Actions</a></li>
<li class="toctree-l3"><a class="reference internal" href="../2_Convertor/2.3.html">2.3 - Adding the Code</a></li>
</ul>
</li>
<li class="toctree-l2 current has-children"><a class="reference internal" href="index.html">3 - TimeMachine - a single window application</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of 3 - TimeMachine - a single window application</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="3.1.html">3.1 - A Basic Clock</a></li>
<li class="toctree-l3"><a class="reference internal" href="3.2.html">3.2 - Analog Clock</a></li>
<li class="toctree-l3"><a class="reference internal" href="3.3.html">3.3 - New Time Zone Dialog</a></li>
<li class="toctree-l3 current current-page"><a class="current reference internal" href="#">3.4 - Multiple Clocks</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../4_Money/index.html">4 - Money</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of 4 - Money</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../4_Money/4.1.html">4.1 - The Basics</a></li>
<li class="toctree-l3"><a class="reference internal" href="../4_Money/4.2.html">4.2 - Document Editor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../4_Money/4.3.html">4.3 - Load and Save</a></li>
<li class="toctree-l3"><a class="reference internal" href="../4_Money/4.4.html">4.4 - Drag and Drop</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../5_Overview/index.html">5 - Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../6_LunarCalendar/index.html">6 - LunarCalendar</a></li>
<li class="toctree-l2"><a class="reference internal" href="../7_NSLocalizationService/index.html">7 - NSLocalizationService</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Todo/index.html">Todo.app</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Todo.app</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../Todo/Tutorial1.html">1 - Programming under GNUstep</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Todo/Tutorial2.html">2 - NSWindowController and Design Pattern MVC</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../HelpfulWebsites.html">Helpful Websites</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../AppsWithCodeOnly/index.html">Building Apps from Code Only</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of Building Apps from Code Only</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../AppsWithCodeOnly/GettingStarted/index.html">First Steps in GNUstep GUI Programming</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of First Steps in GNUstep GUI Programming</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../AppsWithCodeOnly/GettingStarted/SharedApplication.html">1. The shared application object</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../AppsWithCodeOnly/GettingStarted/AppIcon.html">2 Setting your application’s icon</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../AppsWithCodeOnly/GettingStarted/Menus.html">3 Menus</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../AppsWithCodeOnly/GettingStarted/PointsSizesRectangles.html">1 Points, Sizes and Rectangles</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../AppsWithCodeOnly/GettingStarted/Windows.html">2 Adding a Window to your Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../AppsWithCodeOnly/GettingStarted/Buttons.html">3 Adding a Button in the Window</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../AppsWithRenaissance/index.html">Building Apps with Renaissance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../CommandLineTools/index.html">Command-Line Tools</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="multiple-clocks">
<h1>3.4 - Multiple Clocks<a class="headerlink" href="#multiple-clocks" title="Permalink to this heading">#</a></h1>
<p>In this section, you will add multiple clocks to your clock application, and allow the amount of clocks to be adjusted dynamically, similar to the “World Clocks” feature of the iOS Clocks application.</p>
<div class="admonition-editor-s-note admonition">
<p class="admonition-title">Editor’s note</p>
<p>It’s unclear what the original author meant by “trace”.</p>
</div>
<section id="adding-menu-items">
<h2>Adding menu items<a class="headerlink" href="#adding-menu-items" title="Permalink to this heading">#</a></h2>
<p>Since I can change the time zone, I would like to display several clock
at the same window, and adjust the number of clocks dynamically. First,
I need to add new submenu: “Edit”, and two menu item in it: “Add Clock”
and “Delete Clock”. Then add two action in the class “Controller”:
“addClock:” and “deleteClock”. Connect the menu item to the action in
the instance of class “Controller” in the gorm file. Then I have done
the part of interface. When user select the menu item “Add Clock”, the
method “addClock:” will be called, so does the menu item “Delete Clock”.</p>
</section>
<section id="notifications-prelude">
<h2>Notifications - prelude<a class="headerlink" href="#notifications-prelude" title="Permalink to this heading">#</a></h2>
<p>Now, how do you manage these clocks dynamically? You could keep track of each of them manually, but it will be complicated. You could also not keep track of any of them, but then you can’t control them. Instead, you can use the notifications, which is a pretty handy way to communicate between objects.</p>
<p>Here is a related article:
<a class="reference external" href="https://web.archive.org/web/20030424000148if_/http://cocoadevcentral.com/articles/000029.php"><em>NSNotificationCenter</em></a></p>
</section>
<section id="updating-the-interface">
<h2>Updating the interface<a class="headerlink" href="#updating-the-interface" title="Permalink to this heading">#</a></h2>
<p>First, you need to adjust the interface according to the amount of clocks. You need to count how many clocks exist so that the user doesn’t accidentally delete the last clock.</p>
<p><code class="docutils literal notranslate"><span class="pre">Controller.h:</span></code></p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="cp">#import &lt;AppKit/AppKit.h&gt;</span>
<span class="cp">#import &quot;TimeView.h&quot;</span>

<span class="k">@interface</span> <span class="nc">Controller</span> : <span class="bp">NSObject</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">id</span><span class="w"> </span><span class="n">timeView</span><span class="p">;</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">totalNumber</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">showCurrentTime:</span><span class="w"> </span><span class="p">(</span><span class="kt">id</span><span class="p">)</span> <span class="nv">sender</span><span class="p">;</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">addClock:</span><span class="w"> </span><span class="p">(</span><span class="kt">id</span><span class="p">)</span> <span class="nv">sender</span><span class="p">;</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">deleteClock:</span><span class="w"> </span><span class="p">(</span><span class="kt">id</span><span class="p">)</span> <span class="nv">sender</span><span class="p">;</span>
<span class="k">@end</span>
</pre></div>
</div>
<p>We add an ivar (instance variable), <code class="docutils literal notranslate"><span class="pre">totalNumber</span></code>, to trace the number of clocks, and add two actions manually since we didn’t generate the class files from Gorm.</p>
<p><code class="docutils literal notranslate"><span class="pre">Controller.m:</span></code></p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span> <span class="nf">init</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nb">self</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nb">super</span><span class="w"> </span><span class="n">init</span><span class="p">];</span>
<span class="w">    </span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">totalNumber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">self</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">addClock:</span><span class="w"> </span><span class="p">(</span><span class="kt">id</span><span class="p">)</span> <span class="nv">sender</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">TimeView</span><span class="o">*</span><span class="w"> </span><span class="n">aView</span><span class="p">;</span>
<span class="w">    </span><span class="n">NSWindow</span><span class="o">*</span><span class="w"> </span><span class="n">mainWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">NSApp</span><span class="w"> </span><span class="n">mainWindow</span><span class="p">];</span>
<span class="w">    </span><span class="n">NSRect</span><span class="w"> </span><span class="n">windowFrame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">mainWindow</span><span class="w"> </span><span class="n">frame</span><span class="p">];</span>
<span class="w">    </span><span class="n">NSRect</span><span class="w"> </span><span class="n">timeViewFrame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">timeView</span><span class="w"> </span><span class="n">frame</span><span class="p">];</span>

<span class="w">    </span><span class="p">[</span><span class="n">mainWindow</span><span class="w"> </span><span class="n">setFrame</span><span class="o">:</span><span class="w"> </span><span class="n">NSMakeRect</span><span class="p">(</span>
<span class="w">                    </span><span class="n">windowFrame</span><span class="p">.</span><span class="n">origin</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w">    </span>
<span class="w">                    </span><span class="n">windowFrame</span><span class="p">.</span><span class="n">origin</span><span class="p">.</span><span class="n">y</span><span class="p">,</span>
<span class="w">                    </span><span class="n">windowFrame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span>
<span class="w">                     </span><span class="o">+</span><span class="w"> </span><span class="n">timeViewFrame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">,</span><span class="w"> </span>
<span class="w">                    </span><span class="n">windowFrame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span>
<span class="w">                  </span><span class="p">)</span>
<span class="w">                 </span><span class="nl">display</span><span class="p">:</span><span class="w"> </span><span class="nb">YES</span><span class="p">];</span>
<span class="w">    </span><span class="n">aView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">timeView</span><span class="w"> </span><span class="n">alloc</span><span class="p">]</span><span class="w"> </span>
<span class="w">              </span><span class="nl">initWithFrame</span><span class="p">:</span><span class="w"> </span><span class="n">NSMakeRect</span><span class="p">(</span>
<span class="w">                  </span><span class="n">timeViewFrame</span><span class="p">.</span><span class="n">origin</span><span class="p">.</span><span class="n">x</span>
<span class="w">                   </span><span class="o">+</span><span class="w"> </span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">totalNumber</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">timeViewFrame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">,</span>
<span class="w">                  </span><span class="n">timeViewFrame</span><span class="p">.</span><span class="n">origin</span><span class="p">.</span><span class="n">y</span><span class="p">,</span>
<span class="w">                  </span><span class="n">timeViewFrame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">,</span>
<span class="w">                  </span><span class="n">timeViewFrame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span>
<span class="w">              </span><span class="p">)</span>
<span class="w">            </span><span class="p">];</span>
<span class="w">    </span>
<span class="w">    </span><span class="p">[[</span><span class="n">mainWindow</span><span class="w"> </span><span class="n">contentView</span><span class="p">]</span><span class="w"> </span><span class="n">addSubview</span><span class="o">:</span><span class="w"> </span><span class="n">aView</span><span class="p">];</span>
<span class="w">    </span><span class="p">[</span><span class="n">aView</span><span class="w"> </span><span class="k">release</span><span class="p">];</span>
<span class="w">    </span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">totalNumber</span><span class="w"> </span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">deleteClock:</span><span class="w"> </span><span class="p">(</span><span class="kt">id</span><span class="p">)</span> <span class="nv">sender</span>
<span class="p">{</span>
<span class="w">    </span><span class="bp">NSArray</span><span class="o">*</span><span class="w"> </span><span class="n">subviews</span><span class="p">;</span>
<span class="w">    </span><span class="n">NSWindow</span><span class="o">*</span><span class="w"> </span><span class="n">mainWindow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">NSApp</span><span class="w"> </span><span class="n">mainWindow</span><span class="p">];</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<span class="w">    </span><span class="n">NSRect</span><span class="w"> </span><span class="n">windowFrame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">mainWindow</span><span class="w"> </span><span class="n">frame</span><span class="p">];</span>
<span class="w">    </span><span class="n">NSRect</span><span class="w"> </span><span class="n">timeViewFrame</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">timeView</span><span class="w"> </span><span class="n">frame</span><span class="p">];</span>

<span class="w">    </span><span class="n">subviews</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="n">mainWindow</span><span class="w"> </span><span class="n">contentView</span><span class="p">]</span><span class="w"> </span><span class="n">subviews</span><span class="p">];</span>

<span class="w">    </span><span class="c1">// This part was originally formatted unreadably, so it&#39;s possible that the boundaries of the `if` statement are incorrect.</span>

<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">subviews</span><span class="w"> </span><span class="n">count</span><span class="p">]</span><span class="mi">-1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">--</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span>
<span class="w">            </span><span class="p">[[</span><span class="n">subviews</span><span class="w"> </span><span class="n">objectAtIndex</span><span class="o">:</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span>
<span class="w">              </span><span class="nl">isMemberOfClass</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">timeView</span><span class="w"> </span><span class="k">class</span><span class="p">]]</span>
<span class="w">        </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="p">[[</span><span class="n">subviews</span><span class="w"> </span><span class="n">objectAtIndex</span><span class="o">:</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="n">removeFromSuperview</span><span class="p">];</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">totalNumber</span><span class="w"> </span><span class="o">--</span><span class="p">;</span>
<span class="w">        </span><span class="p">[</span><span class="n">mainWindow</span><span class="w"> </span><span class="n">setFrame</span><span class="o">:</span><span class="w"> </span><span class="n">NSMakeRect</span><span class="p">(</span>
<span class="w">                                  </span><span class="n">windowFrame</span><span class="p">.</span><span class="n">origin</span><span class="p">.</span><span class="n">x</span><span class="p">,</span>
<span class="w">                                  </span><span class="n">windowFrame</span><span class="p">.</span><span class="n">origin</span><span class="p">.</span><span class="n">y</span><span class="p">,</span>
<span class="w">                                  </span><span class="n">windowFrame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span>
<span class="w">                                   </span><span class="o">-</span><span class="w"> </span><span class="n">timeViewFrame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">,</span>
<span class="w">                                  </span><span class="n">windowFrame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="p">)</span>
<span class="w">                     </span><span class="nl">display</span><span class="p">:</span><span class="w"> </span><span class="nb">YES</span><span class="p">];</span>
<span class="w">        </span><span class="k">break</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In the method <code class="docutils literal notranslate"><span class="pre">-init</span></code>, we initialize <code class="docutils literal notranslate"><span class="pre">totalNumber</span></code> to 1 since
there is already one clock in the Gorm file. In the method <code class="docutils literal notranslate"><span class="pre">-addClock:</span></code>, we
calculate the necessary change in the window size and where to put the new clock. They
are done by very simple calculation. Once we add the new clock into the
window, the window will <code class="docutils literal notranslate"><span class="pre">retain</span></code> this clock. Therefore, we can <code class="docutils literal notranslate"><span class="pre">release</span></code> it
and no longer trace it. In the method <code class="docutils literal notranslate"><span class="pre">-deleteClock:</span></code>, we also need to
change the size of window by simple calculation. The only problem is
that since we don’t trace the clocks, how do we delete them? We can get
all the subviews from the window, and delete the last <code class="docutils literal notranslate"><span class="pre">TimeView</span></code>
object. This way is very easy to maintain.</p>
</section>
<section id="notifications">
<h2>Notifications<a class="headerlink" href="#notifications" title="Permalink to this heading">#</a></h2>
<p>Now, if you hit the button <button>Get Current Time</button>, you will notice that only
the original clock is updated. That’s because it is the only one which is
connected to the outlet. We could get all the subviews from the window, and
call their method one by one. That would work, but it’s not elegant.
I can use the “Notification” and “Notification Center” to archive this
goal. Read the <a class="reference external" href="https://web.archive.org/web/20010321022850if_/https://developer.apple.com/techpubs/macosx/Cocoa/TasksAndConcepts/ProgrammingTopics/Notifications/index.html"><em>Cocoa
document</em></a>
for more details.</p>
<p>The idea is that an object can be a speaker, and many objects can be the
audience. Each member of the audience is called an “observer”.</p>
<p>So when the user press the button <button>Get Current Time</button>, the “Controller” must speak to all the clocks. Below is how it speaks:</p>
<p><code class="docutils literal notranslate"><span class="pre">Controller.h:</span></code></p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">showCurrentTime:</span><span class="w"> </span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">sender</span>
<span class="p">{</span>
<span class="w">    </span><span class="p">[[</span><span class="bp">NSNotificationCenter</span><span class="w"> </span><span class="n">defaultCenter</span><span class="p">]</span>
<span class="w">      </span><span class="nl">postNotificationName</span><span class="p">:</span><span class="w"> </span><span class="s">@&quot;TimeViewShouldUpdateCurrentTime&quot;</span>
<span class="w">                    </span><span class="nl">object</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="n">NSCalendarDate</span><span class="w"> </span><span class="n">date</span><span class="p">]];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Actually, it talks to the “Notification Center”, and the notification
center will broadcast what it says. I need to specify the name of the
notification because there are so many notifications passing through the center. The
name of the notification distinguishes the notification. And a notification
can contain an object within it, which stores the information that the speaker is sending to the audience. It can be <code class="docutils literal notranslate"><span class="pre">nil</span></code>. Here, I use <code class="docutils literal notranslate"><span class="pre">+[NSCalendarDate</span> <span class="pre">date]</span></code>.</p>
<p>Now, the speaker speaks. How does the audience listen? In this example,
all the instances of <code class="docutils literal notranslate"><span class="pre">TimeView</span></code> should listen in order to themselves with the current time. For an object to listen, they need to register as an “observer” with the Notification Center.</p>
<p><code class="docutils literal notranslate"><span class="pre">TimeView.m:</span></code></p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span> <span class="nf">initWithFrame:</span><span class="w"> </span><span class="p">(</span><span class="n">NSRect</span><span class="p">)</span> <span class="nv">frame</span>
<span class="p">{</span>
<span class="w">    </span><span class="nb">self</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nb">super</span><span class="w"> </span><span class="n">initWithFrame</span><span class="o">:</span><span class="w"> </span><span class="n">frame</span><span class="p">];</span>

<span class="w">    </span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">box</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="n">NSBox</span><span class="w"> </span><span class="n">alloc</span><span class="p">]</span>
<span class="w">                  </span><span class="nl">initWithFrame</span><span class="p">:</span><span class="w"> </span><span class="n">NSMakeRect</span><span class="p">(</span>
<span class="w">                    </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="c1">// x=0, y=0</span>
<span class="w">                    </span><span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">,</span>
<span class="w">                    </span><span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span>
<span class="w">                  </span><span class="p">)</span>
<span class="w">                </span><span class="p">];</span>
<span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">box</span><span class="w"> </span><span class="n">setBorderType</span><span class="o">:</span><span class="w"> </span><span class="n">NSGrooveBorder</span><span class="p">];</span>
<span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">box</span><span class="w"> </span><span class="n">setTitlePosition</span><span class="o">:</span><span class="w"> </span><span class="n">NSAtTop</span><span class="p">];</span>
<span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">box</span><span class="w"> </span><span class="n">setTitle</span><span class="o">:</span><span class="w"> </span><span class="s">@&quot;Local Time&quot;</span><span class="p">];</span>

<span class="w">    </span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">clockView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="n">ClockView</span><span class="w"> </span><span class="n">alloc</span><span class="p">]</span>
<span class="w">                  </span><span class="nl">initWithFrame</span><span class="p">:</span><span class="w"> </span><span class="n">NSMakeRect</span><span class="p">(</span>
<span class="w">                    </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">70</span><span class="p">,</span><span class="w"> </span><span class="c1">// x=0, y=70 </span>
<span class="w">                    </span><span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="p">,</span>
<span class="w">                    </span><span class="n">frame</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span>
<span class="w">                  </span><span class="p">)</span>
<span class="w">                </span><span class="p">];</span>
<span class="w">    </span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">labelDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="n">NSTextField</span><span class="w"> </span><span class="n">alloc</span><span class="p">]</span>
<span class="w">                  </span><span class="nl">initWithFrame</span><span class="p">:</span><span class="w"> </span><span class="n">NSMakeRect</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">45</span><span class="p">,</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">)];</span>
<span class="w">                                 </span><span class="c1">// x=10, y=45, width=35, height=20</span>
<span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">labelDate</span><span class="w"> </span><span class="n">setStringValue</span><span class="o">:</span><span class="w"> </span><span class="s">@&quot;Date: &quot;</span><span class="p">];</span>
<span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">labelDate</span><span class="w"> </span><span class="n">setBezeled</span><span class="o">:</span><span class="w"> </span><span class="nb">NO</span><span class="p">];</span>
<span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">labelDate</span><span class="w"> </span><span class="n">setBackgroundColor</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="n">NSColor</span><span class="w"> </span><span class="n">windowBackgroundColor</span><span class="p">]];</span>
<span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">labelDate</span><span class="w"> </span><span class="n">setEditable</span><span class="o">:</span><span class="w"> </span><span class="nb">NO</span><span class="p">];</span>

<span class="w">    </span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">labelTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="n">NSTextField</span><span class="w"> </span><span class="n">alloc</span><span class="p">]</span><span class="w"> </span>
<span class="w">                  </span><span class="nl">initWithFrame</span><span class="p">:</span><span class="w"> </span><span class="n">NSMakeRect</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">35</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">)];</span>
<span class="w">                                 </span><span class="c1">// x=10, y=15, width=35, height=20</span>
<span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">labelTime</span><span class="w"> </span><span class="n">setStringValue</span><span class="o">:</span><span class="w"> </span><span class="s">@&quot;Time: &quot;</span><span class="p">];</span>
<span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">labelTime</span><span class="w"> </span><span class="n">setBezeled</span><span class="o">:</span><span class="w"> </span><span class="nb">NO</span><span class="p">];</span>
<span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">labelTime</span><span class="w"> </span><span class="n">setBackgroundColor</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="n">NSColor</span><span class="w"> </span><span class="n">windowBackgroundColor</span><span class="p">]];</span>
<span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">labelTime</span><span class="w"> </span><span class="n">setEditable</span><span class="o">:</span><span class="w"> </span><span class="nb">NO</span><span class="p">];</span>

<span class="w">    </span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">localDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="n">NSTextField</span><span class="w"> </span><span class="n">alloc</span><span class="p">]</span>
<span class="w">                  </span><span class="nl">initWithFrame</span><span class="p">:</span><span class="w"> </span><span class="n">NSMakeRect</span><span class="p">(</span><span class="mi">55</span><span class="p">,</span><span class="w"> </span><span class="mi">45</span><span class="p">,</span><span class="w"> </span><span class="mi">130</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">)];</span>
<span class="w">    </span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">localTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[[</span><span class="n">NSTextField</span><span class="w"> </span><span class="n">alloc</span><span class="p">]</span>
<span class="w">                  </span><span class="nl">initWithFrame</span><span class="p">:</span><span class="w"> </span><span class="n">NSMakeRect</span><span class="p">(</span><span class="mi">55</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">130</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">)];</span>

<span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">box</span><span class="w"> </span><span class="n">addSubview</span><span class="o">:</span><span class="w"> </span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">clockView</span><span class="p">];</span>
<span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">box</span><span class="w"> </span><span class="n">addSubview</span><span class="o">:</span><span class="w"> </span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">labelDate</span><span class="p">];</span>
<span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">box</span><span class="w"> </span><span class="n">addSubview</span><span class="o">:</span><span class="w"> </span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">labelTime</span><span class="p">];</span>
<span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">box</span><span class="w"> </span><span class="n">addSubview</span><span class="o">:</span><span class="w"> </span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">localDate</span><span class="p">];</span>
<span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">box</span><span class="w"> </span><span class="n">addSubview</span><span class="o">:</span><span class="w"> </span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">localTime</span><span class="p">];</span>
<span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">clockView</span><span class="w"> </span><span class="k">release</span><span class="p">];</span>
<span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">labelDate</span><span class="w"> </span><span class="k">release</span><span class="p">];</span>
<span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">labelTime</span><span class="w"> </span><span class="k">release</span><span class="p">];</span>
<span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">localDate</span><span class="w"> </span><span class="k">release</span><span class="p">];</span>
<span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">localTime</span><span class="w"> </span><span class="k">release</span><span class="p">];</span>

<span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="w"> </span><span class="n">addSubview</span><span class="o">:</span><span class="w"> </span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">box</span><span class="p">];</span>
<span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">box</span><span class="w"> </span><span class="k">release</span><span class="p">];</span>

<span class="w">    </span><span class="p">[[</span><span class="bp">NSNotificationCenter</span><span class="w"> </span><span class="n">defaultCenter</span><span class="p">]</span><span class="w"> </span>
<span class="w">      </span><span class="nl">addObserver</span><span class="p">:</span><span class="w"> </span><span class="nb">self</span>
<span class="w">         </span><span class="nl">selector</span><span class="p">:</span><span class="w"> </span><span class="k">@selector</span><span class="p">(</span><span class="n">setDate</span><span class="o">:</span><span class="p">)</span>
<span class="w">             </span><span class="nl">name</span><span class="p">:</span><span class="w"> </span><span class="s">@&quot;TimeViewShouldUpdateCurrentTime&quot;</span>
<span class="w">           </span><span class="nl">object</span><span class="p">:</span><span class="w"> </span><span class="nb">nil</span><span class="p">];</span>
<span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="w"> </span><span class="n">showCurrentTime</span><span class="o">:</span><span class="w"> </span><span class="nb">self</span><span class="p">];</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">self</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Only one line is needed to register an observer. It specify what object to receive
the notification (<code class="docutils literal notranslate"><span class="pre">addObserver:</span></code>), which method to handle the notification
(<code class="docutils literal notranslate"><span class="pre">selector:</span></code>), the name of the notification being observed (<code class="docutils literal notranslate"><span class="pre">name:</span></code>), and the
object of the notification (<code class="docutils literal notranslate"><span class="pre">object:</span></code>). It is important that the name of
notification should be the same as what the speaker uses. So once the
speaker sends <code class="docutils literal notranslate"><span class="pre">TimeViewShouldUpdateCurrentTime</span></code>, the observers of <code class="docutils literal notranslate"><span class="pre">TimeViewShouldUpdateCurrentTime</span></code> will receive the
notification, and the <code class="docutils literal notranslate"><span class="pre">setDate:</span></code> message will be sent to the observer. The <code class="docutils literal notranslate"><span class="pre">object:</span> <span class="pre">nil</span></code> means
that this object accept all notifications with the name
<code class="docutils literal notranslate"><span class="pre">TimeViewShouldUpdateCurrentTime</span></code> no matter what kind of object it
carries.</p>
<p>Now, we register the TimeView for the notification
<code class="docutils literal notranslate"><span class="pre">TimeViewShouldUpdateCurrentTime</span></code>. Once the speaker speaks, the method
<code class="docutils literal notranslate"><span class="pre">-setDate:</span></code> will be called. So we need to implement this method.</p>
<p><code class="docutils literal notranslate"><span class="pre">TimeView.m:</span></code></p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">setDate:</span><span class="w"> </span><span class="p">(</span><span class="bp">NSNotification</span><span class="w"> </span><span class="o">*</span><span class="p">)</span> <span class="nv">notification</span>
<span class="p">{</span>
<span class="w">   </span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">notification</span><span class="w"> </span><span class="n">object</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">date</span><span class="w"> </span><span class="n">setTimeZone</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="bp">NSTimeZone</span><span class="w"> </span><span class="n">timeZoneWithName</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="n">box</span><span class="w"> </span><span class="n">title</span><span class="p">]]];</span>
<span class="w">   </span><span class="p">[</span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">date</span><span class="w"> </span><span class="n">setCalendarFormat</span><span class="o">:</span><span class="w"> </span><span class="s">@&quot;%a, %b %e, %Y&quot;</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">localDate</span><span class="w"> </span><span class="n">setStringValue</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">date</span><span class="w"> </span><span class="n">description</span><span class="p">]];</span>
<span class="w">   </span><span class="p">[</span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">date</span><span class="w"> </span><span class="n">setCalendarFormat</span><span class="o">:</span><span class="w"> </span><span class="s">@&quot;%H : %M : %S&quot;</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">localTime</span><span class="w"> </span><span class="n">setStringValue</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">date</span><span class="w"> </span><span class="n">description</span><span class="p">]];</span>
<span class="w">   </span><span class="p">[</span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">clockView</span><span class="w"> </span><span class="n">setDate</span><span class="o">:</span><span class="w"> </span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">date</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We reuse the <code class="docutils literal notranslate"><span class="pre">-setDate:</span></code> from Section 3.2, but change the interface
because right now, it is called by the Notification Center. And I can get
the object the notification carries by using <code class="docutils literal notranslate"><span class="pre">[NSNotification</span> <span class="pre">object]</span></code> method.</p>
<p>Finally, I need to remove the observer from the Notification Center when it
is destroyed. Otherwise, it causes problems. So here is the <code class="docutils literal notranslate"><span class="pre">-dealloc</span></code> method.</p>
<p><code class="docutils literal notranslate"><span class="pre">TimeView.m:</span></code></p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">dealloc</span>
<span class="p">{</span>
<span class="w">   </span><span class="p">[[</span><span class="bp">NSNotificationCenter</span><span class="w"> </span><span class="n">defaultCenter</span><span class="p">]</span><span class="w"> </span><span class="n">removeObserver</span><span class="o">:</span><span class="w"> </span><span class="nb">self</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">date</span><span class="w"> </span><span class="k">release</span><span class="p">];</span>
<span class="w">   </span><span class="p">[</span><span class="nb">super</span><span class="w"> </span><span class="n">dealloc</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To sum up, the speaker speaks to the Notification Center with a specific notification name, and may or may not put an object on the
notification. The audience register themselves to the Notification Center
with what kinds of notification they want to receive by the name of
notification. When the Notification Center recieves the notification, it will call the registered method on each of the observers.</p>
<p>There are some source code needed to be modified due to the change in the
<code class="docutils literal notranslate"><span class="pre">setDate:</span></code> method. They are not shown here, and it’s not hard to figure
them out.</p>
</section>
<section id="timers">
<h2>Timers<a class="headerlink" href="#timers" title="Permalink to this heading">#</a></h2>
<p>Since I can update all the clocks manually, I can do it automatically.
<code class="docutils literal notranslate"><span class="pre">NSTimer</span></code> is a timer which can trigger an action after a given time
repeatly or not. Here, I’ll use a <code class="docutils literal notranslate"><span class="pre">NSTimer</span></code> to make the clock “run”.</p>
<p>I need to add a new submenu “Timer”, and two menu items: “Start” and
“Stop”. Add two action in class <code class="docutils literal notranslate"><span class="pre">Controller</span></code>: “startTimer:” and
“stopTimer:”. Then connect the menu item to the action. This should be
very easy by now.</p>
<p><span id="AEN884"></span></p>
<p><strong>Figure 4-31. Connect menu action</strong></p>
<p><img alt="" src="../../_images/Notification-01.jpg" /></p>
<p><img alt="" src="../../_images/Notification-02.jpg" /></p>
<p><img alt="" src="../../_images/Notification-03.jpg" /></p>
<p>Add these two actions and a <code class="docutils literal notranslate"><span class="pre">NSTimer</span></code> in <code class="docutils literal notranslate"><span class="pre">Controller</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">Controller.h:</span></code></p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="cp">#import &lt;AppKit/AppKit.h&gt;</span>
<span class="cp">#import &quot;TimeView.h&quot;</span>

<span class="k">@interface</span> <span class="nc">Controller</span> : <span class="bp">NSObject</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">id</span><span class="w"> </span><span class="n">timeView</span><span class="p">;</span>
<span class="w">    </span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">totalNumber</span><span class="p">;</span>
<span class="w">    </span><span class="bp">NSTimer</span><span class="w"> </span><span class="o">*</span><span class="n">timer</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">showCurrentTime:</span><span class="w"> </span><span class="p">(</span><span class="kt">id</span><span class="p">)</span> <span class="nv">sender</span><span class="p">;</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">addClock:</span><span class="w"> </span><span class="p">(</span><span class="kt">id</span><span class="p">)</span> <span class="nv">sender</span><span class="p">;</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">deleteClock:</span><span class="w"> </span><span class="p">(</span><span class="kt">id</span><span class="p">)</span> <span class="nv">sender</span><span class="p">;</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">startTimer:</span><span class="w"> </span><span class="p">(</span><span class="kt">id</span><span class="p">)</span> <span class="nv">sender</span><span class="p">;</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">stopTimer:</span><span class="w"> </span><span class="p">(</span><span class="kt">id</span><span class="p">)</span> <span class="nv">sender</span><span class="p">;</span>
<span class="k">@end</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Controller.m:</span></code></p>
<div class="highlight-objc notranslate"><div class="highlight"><pre><span></span><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">startTimer:</span><span class="w"> </span><span class="p">(</span><span class="kt">id</span><span class="p">)</span> <span class="nv">sender</span>
<span class="p">{</span>
<span class="w">    </span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">timer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="bp">NSTimer</span><span class="w"> </span><span class="n">scheduledTimerWithTimeInterval</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                                        </span><span class="nl">target</span><span class="p">:</span><span class="w"> </span><span class="nb">self</span>
<span class="w">                                      </span><span class="nl">selector</span><span class="p">:</span><span class="w"> </span><span class="k">@selector</span><span class="p">(</span><span class="n">showCurrentTime</span><span class="o">:</span><span class="p">)</span>
<span class="w">                                      </span><span class="nl">userInfo</span><span class="p">:</span><span class="w"> </span><span class="nb">nil</span>
<span class="w">                                       </span><span class="nl">repeats</span><span class="p">:</span><span class="w"> </span><span class="nb">YES</span><span class="p">];</span>
<span class="p">}</span>

<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">stopTimer:</span><span class="w"> </span><span class="p">(</span><span class="kt">id</span><span class="p">)</span> <span class="nv">sender</span>
<span class="p">{</span>
<span class="w">    </span><span class="p">[</span><span class="nb">self</span><span class="o">-&gt;</span><span class="n">timer</span><span class="w"> </span><span class="n">invalidate</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>That’s all. In <code class="docutils literal notranslate"><span class="pre">NSTimer</span></code>, we set the interval, target, selector (method to call), and whether it repeats. Then it will trigger the action <code class="docutils literal notranslate"><span class="pre">-showCurrentTime:</span></code> every second.
Use <code class="docutils literal notranslate"><span class="pre">-invalidate</span></code> to stop the timer. Generally, you need to write a thread
in order not to block the user interface. But with the help of <code class="docutils literal notranslate"><span class="pre">NSTimer</span></code>,
you can totally avoid this problem. Finger (in gnustep/usr-apps/ (might be a broken link)) is
another good example how to avoid thread using non-blocking I/O.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Since <code class="docutils literal notranslate"><span class="pre">self-&gt;timer</span></code> is autoreleased, it might disappear anytime in this example, which causes a serious memory problem, and usually makes the application unstable. It would be better to retain the timer in <code class="docutils literal notranslate"><span class="pre">-startTimer:</span></code> and release it in <code class="docutils literal notranslate"><span class="pre">-stopTimer:</span></code>, and to ensure that only one timer exists when the user click the “start” menu more than once.</p>
</div>
<p><strong>Congratulations! You have learned many new things over the course of this tutorial.</strong></p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../4_Money/index.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">4 - Money</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="3.3.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">3.3 - New Time Zone Dialog</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, GNUstep contributors
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">3.4 - Multiple Clocks</a><ul>
<li><a class="reference internal" href="#adding-menu-items">Adding menu items</a></li>
<li><a class="reference internal" href="#notifications-prelude">Notifications - prelude</a></li>
<li><a class="reference internal" href="#updating-the-interface">Updating the interface</a></li>
<li><a class="reference internal" href="#notifications">Notifications</a></li>
<li><a class="reference internal" href="#timers">Timers</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=172f29ee"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../_static/scripts/furo.js?v=32e29ea5"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/design-tabs.js?v=36754332"></script>
    </body>
</html>